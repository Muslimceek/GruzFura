
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /listings/{listingId} {
      // 1. Read is public
      allow read: if true;

      // 2. Create allowed if authenticated and creatorId matches
      allow create: if request.auth != null 
                   && request.resource.data.creatorId == request.auth.uid;

      // 3. Delete allowed if owner
      allow delete: if request.auth != null 
                   && resource.data.creatorId == request.auth.uid;

      // 4. Update allowed if owner (e.g. changing status to 'closed')
      allow update: if request.auth != null 
                   && resource.data.creatorId == request.auth.uid;
    }
  }
}
